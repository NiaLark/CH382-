# PCIE 总线双串口及打印口芯片 CH382 技术手册

版本：1

网址：[http://wch.cn](http://wch.cn)

## 1. 概述

CH382 是 PCI-Express 总线的双串口及打印口芯片，包含两个兼容 16C550 或者 16C750 的异步串口和一个 EPP/ECP 增强型双向并口。异步串口提供收发独立的 256 字节 FIFO 缓冲器，支持最高 8Mbps 的通讯波特率，可以用于 PCIE 总线的 RS232 串口扩展、带自动硬件速率控制的 PCIE 高速串口、串口组网、RS485 通讯、并口/打印口扩展等。下图为其一般应用框图。
![image](https://github.com/user-attachments/assets/89162b0d-2909-466b-9eae-1c2c62f511bf)


## 2. 特点

### 2.1 概述

- 同一芯片可配置为 PCIE 总线的双串口、单并口/打印口、双串口加并口/打印口。
- 提供两线串行主机接口，可以挂接类似 24C0X 的串口 EEPROM 器件用于存储非易失数据。
- 可以在 EEPROM 器件中设定 PCIE 板卡的设备标识（Vendor ID，Device ID，Class Code 等）。
- 驱动程序支持 Windows 98/ME/NT4.0/2000/XP/Vista/Win7/Server2003 以及 Linux。
- 3.3V 电源电压，I/O 引脚支持 5V 耐压。
- 芯片功能相当于 CH367 芯片加 CH438 芯片，提供 4 串口、8 串口及更多串口的应用方案。
- 支持 PCMCIA 之 ExpressCard 笔记本插卡。
- LQFP-64 无铅封装，兼容 RoHS。

### 2.2 串口

- 完全独立的 2 个异步串口，兼容 16C550、16C552、16C554 及 16C750 并且有所增强。
- 支持 5、6、7 或者 8 个数据位以及 1 或者 2 个停止位。
- 支持奇、偶、无校验、空白 0、标志 1 等校验方式。
- 可编程通讯波特率，支持 115200bps 以及最高达 8Mbps 的通讯波特率。
- 内置 256 字节的 FIFO 先进先出缓冲器，支持 4 个 FIFO 触发级。
- 支持 MODEM 调制解调器信号 CTS、DSR、RI、DCD、DTR、RTS，可转成 RS232 电平。
- 支持硬件流控制信号 CTS 和 RTS 自动握手和自动传输速率控制，兼容 TL16C550C。
- 支持串口帧错误检测、支持 Break 线路间隔检测。
- 支持全双工和半双工串口通讯。

### 2.3 并口

- 支持 SPP、Nibble、Byte、PS/2、EPP、ECP 等 IEEE1284 并口/打印口工作方式。
- 支持双向数据传输，支持最高达 1M 字节/每秒的传输速度。

## 3. 封装
![image](https://github.com/user-attachments/assets/98b38bf9-4ac7-4c8c-9c60-603585bb7aea)



## 4. 引脚

### 4.1 电源线
![image](https://github.com/user-attachments/assets/a7520584-7503-4508-bdb9-2f0fb0516277)


### 4.2 PCIE 总线信号线

![image](https://github.com/user-attachments/assets/ea528c34-01d0-42d9-b249-445b57f538f7)

### 4.3 串口 0 和串口 1 信号线

| 引脚号 | 引脚名称 | 类型 | 引脚说明                                      |
|--------|----------|------|-----------------------------------------------|
| 31/38  | CTS0/CTS1 | 输入 | MODEM 信号，清除发送，低电平有效，内置上拉电阻  |
| 30/37  | DSR0/DSR1 | 输入 | MODEM 信号，数据装置就绪，低电平有效，内置上拉电阻 |
| 29/36  | RI0/RI1   | 输入 | MODEM 信号，振铃指示，低电平有效，内置上拉电阻   |
| 28/35  | DCD0/DCD1 | 输入 | MODEM 信号，载波检测，低电平有效，内置上拉电阻  |
| 27/34  | RXD0/RXD1 | 输入 | 异步串行数据输入，内置上拉电阻                  |
| 52/55  | DTR0/DTR1 | 输出 | MODEM 信号，数据终端就绪，低电平有效             |
| 51/54  | RTS0/RTS1 | 输出 | MODEM 信号，请求发送，低电平有效                |
| 50/53  | TXD0/TXD1 | 输出 | 异步串行数据输出                               |

### 4.4 打印口信号线

![image](https://github.com/user-attachments/assets/2ac58516-a3a7-418b-9d68-71f3f5a2bc37)

### 4.5 辅助信号线
![image](https://github.com/user-attachments/assets/6cf957be-fffc-4185-be84-bb215d1a638a)


### 5. 配置

### 5.1 全局功能配置

CH382 芯片具有 3 种功能模式：

![image](https://github.com/user-attachments/assets/64d6a278-6957-4c7b-ba55-4adc9932fbb6)

CH382 芯片的 CKSEL 引脚用于选择内部 2 串口的时钟频率：
 CKSEL 接 VCC33 或者悬空，即 CKSEL=1，则从 XO 引脚输入时钟，频率由外部晶体决定，且内
部频率系数默认为 1/12 分频，支持再通过 CK2X 或者 CKnS 选择 2 倍频；

CKSEL 接 GND，即 CKSEL=0，则从 XO 引脚输入时钟，频率由外部晶体决定，且内部频率系数
总是强制为 2 倍频；

CKSEL 接 PERST#引脚，即 CKSEL=R，则内部晶体振荡器禁用，而由内部 PLL 提供频率为 125MHz
的时钟，且内部频率系数默认为 1/68 分频，支持再通过 CK2X 或者 CKnS 选择不分频。
在单并口模式下，CKSEL 应该连接 PERST#引脚，以禁用内部晶体振荡器。

### 5.2 外部配置芯片

CH382 芯片会在每次开机或者 PCIE 总线复位后检查外部的 24CXX 配置芯片中的数据，如果连接了配置芯片并且数据有效则自动加载到 CH382 芯片中替换默认的 PCIE 识别信息。

配置芯片 24CXX 是一种 4 脚或者 8 脚封装的非易失串行 EEPROM 存储器，除了向 CH382 提供配置信息之外，还可以供应用程序自行保存一些其它参数。CH382 支持以下型号的 24CXX 芯片：24C01（A）、 24C02、24C04、24C08、24C16 等。

下表是配置芯片 24CXX 中的数据定义。

![image](https://github.com/user-attachments/assets/bfada374-d5f6-4619-b597-4137ab68683b)


### 5.3 串口内部时钟

CH382 芯片内部具有时钟振荡器，可以通过外接晶体及电容产生串口所需的外部时钟信号。如果不接晶体和电容，那么将 CKSEL 引脚接 PERST#引脚则可以通过内部 PLL 产生串口所需时钟。

CH382 内部将 XO 引脚的外部时钟信号进行分频或倍频，分别产生各个串口的内部基准时钟。为了与现有计算机串口的 16C550 芯片兼容，默认的内部时钟频率是 1.8432MHz，对应的最大串口波特率是 115200bps。CH382 芯片支持多种内部时钟频率，当内部时钟频率加倍时，如果应用软件不变， 那么实际的通讯波特率也加倍，即应用软件设置为 115200bps 的串口实际为 230400bps。

CH382 的串口可以由 CKSEL 引脚或者外部配置芯片中的 CFG/FREQ 标志位选择分频或者倍频系数， 将外部时钟的频率转换为两种内部时钟频率，从而支持更多更大的串口波特率。下表是根据 CKSEL 引脚、CFG/FREQ 标志位和外部晶体频率产生串口的内部时钟频率和最大串口波特率。表中 CK2X 是各串口的 IER 寄存器的位 5；表中 CFG 是指外部配置芯片有效标志，CKnS（即 CK0S～CK1S）分别为 FREQ 的位 0～位 1。
| 前置必要条件 | CKSEL=1 | CKSEL=1 | CKSEL=R  | CKSEL=R                                     |
|--------|----------|------|-----------------|------------------------------|
| 组合选择   | CK2X=0 并且CFG 无效或 CKnS=1 | CK2X=1 或者CKSEL=0 或者CFG 有效且 CKnS=0 | CK2X=0 并且CFG 无效或 CKnS=1  |  CK2X=1 或者CFG 有效且 CKnS=0 |
| 内部频率系数            | 1/12 分频 | 2 倍频 | 1/68 分频 | 不分频  |          
| 外部晶体频率22.1184MHz  | 1.8432MHz 115.2Kbps   | 44.2368MHz  2.7648Mbps |    |   |
| 外部晶体频率0.9216MHz   |  | 1.8432MHz 115.2Kbps |   |   |
| 外部晶体频率11.0592MHz  | 0.9216MHz 57.6Kbps | 22.1184MHz 1.3824Mbps |                   |   |
| 外部晶体频率18.432MHz   |  | 36.864MHz 2.304Mbps |              |   |
| 内部 PLL 频率125MHz    |  |  | 1.8382MHz 114.9Kbps                | 125MHz 7.8125Mbps  |

在内部 PLL 方式 1/68 分频下得到的 114.9Kbps 与标准的 115.2Kbps 仅相差 0.27%，可以接受。

## 6. 寄存器

### 6.1 基本约定

- 属性简写：R=完全只读，W=可读可写，S=只读但可以事先设定，….=省略号。
- 数据的数制：如果以 H 结尾则为十六进制数，否则为二进制数。
- 数值的通配符以及属性：r=保留（禁止使用），x=任意值，….=省略号。

### 6.2 PCIE 配置空间

![image](https://github.com/user-attachments/assets/afb1bc4c-e2cd-421c-8958-6c95385dfe3f)

### 6.3. I/O 基址 0 的寄存器

|  偏移地址 | 	寄存器名称 | 	寄存器属性 | 	系统复位后默认值 | 
|----------|------------|-------------|------------------|
|  BFH-00H	 |    保留   	|	（禁止使用）	| 	    0FFH      	|
|  C7H-C0H	|  内部串口 0 的 8 个串口寄存器|  	WW	|  XXH |  
|  CFH-C8H |  	内部串口 1 的 8 个串口寄存器 |  	WW |  	XXH |  
|   E7H-D0H |  	保留 |  	（禁止使用） |  	xxH |  
|   E8H |  	通用输出寄存器GPOR |  	RRRRRRWW |  	rrrrrr11 |  
|  E9H |  	内部中断状态寄存器IINT |  	RRRRRRRR  |  	0rrrrr00  | 
|  EAH  | 	通用输入寄存器 GPIR  | 	RRRRRRRR  | 	rxxrrrr1  | 
|  FFH-EBH  | 	保留  | 	（禁止使用）  | 	xxH  | 

### 6.4.	寄存器的位
![image](https://github.com/user-attachments/assets/6898c1bc-c001-4765-8f4c-6ef175ca29db)

### 6.5.	串口寄存器
  CH382 的串口兼容工业标准 16550 或者 16C750 并有所增强，表中标为灰色的寄存器位为增强功能，并且 FIFO 缓冲器长度扩展为 256 字节，除此之外的寄存器可以参考单串口芯片 16C550 或者双串口芯片 CH432 或者八串口芯片 CH438 的说明。串口 0 寄存器的实际地址为 I/O 基址 0 先加 0C0H 再加表中的偏移地址，串口 1 寄存器的实际地址为 I/O 基址 0 先加 0C8H 再加表中的偏移地址。各个串口的寄存器都相同。表中 DLAB 为寄存器 LCR 的位 7，X 表示不关心 DLAB 值，RO 表示寄存器只读，WO 表示寄存器只写，R/W 表示寄存器可读可写。
  
![image](https://github.com/user-attachments/assets/0cef2bea-c1fb-40ba-955e-1150b47763f5)

下表是串口寄存器在上电复位或者 PCIE 总线复位或者串口软复位之后的默认值。
| 寄存器名称 | 	位 7 | 	位 6 | 	位 5 | 	位 4 | 	位 3 | 	位 2 | 	位 1 | 	位 0 | 
|-----------|--------|-------|-------|-------|-------|-------|-------|-------|
| IER | 	0	| 0 | 	0	 | 0 | 	0	 | 0 | 	0	 | 0 | 
| IIR | 	0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 | 
| FCR | 0 | 0 | 0 |	0 |	0 |	0 |	0 |	0 |
| LCR |	0 |	0 |	0 |	0 |	0 |	0 |	0 |	0 |
| MCR |	0 |	0 |	0 |	0 |	0 |	0 |	0 |	0 |
| LSR |	0 |	1 |	1 |	0 |	0 |	0 |	0	| 0 |
| MSR |	DCD |	RI |	DSR |	CTS |	0 |	0 |	0 |	0 |
| SCR	| 保持 |	保持 |	保持 |	保持 |	保持 |	保持 |	保持 |	保持 |

## 其他寄存器状态

- **FIFO**: 复位，包括清除发送 FIFO 和接收 FIFO。
- **TSR**: 复位，即串口发送移位寄存器复位。
- **RSR**: 复位，即串口接收移位寄存器复位。
- **其它**: 未定义。

RBR：接收缓冲寄存器，如果 LSR 的 DATARDY 位为 1 则可以从该寄存器读取接收到的数据。如果 FIFOEN
为 1 则从串口移位寄存器 RSR 接收到的数据首先被存放于接收 FIFO 中，然后通过该寄存器读出。
THR：发送保持寄存器，包括发送 FIFO，用于写入准备发送的数据。如果 FIFOEN 为 1 则写入的数据
首先被存放于发送 FIFO 中，然后通过发送移位寄存器 TSR 逐个输出。
IER：中断使能寄存器，包括增强功能控制位以及串口中断使能。
RESET：该位置 1 则软复位该串口，该位能够自动清 0，无需软件清 0。
LOWPOWER：该位为 1 则关闭该串口的内部基准时钟，从而使该串口进入低功耗状态。
CK2X：该位为 1 则强制将外部时钟信号 2 倍频后作为串口的内部基准时钟，并且不受 FREQ 位 CKnS
的控制。
IEMODEM：该位为 1 则允许调制解调器输入状态变化中断。
IELINES：该位为 1 则允许接收线路状态中断。
IETHRE：该位为 1 则允许发送保持寄存器空中断。
IERECV：该位为 1 则允许接收到数据中断。
IIR：中断识别寄存器，用于分析中断源并处理。
FIFOENS：该位为 FIFO 启用状态，为 1 表示已经启用 FIFO。
| IID3 | IID2 | IID1 | NOINT | 优先级 | 中断类型         | 中断源                                    | 清中断方法         |
|------|------|------|-------|--------|------------------|-------------------------------------------|--------------------|
| 0    | 0    | 0    | 1     | 无     | 没有中断产生          | 没有中断                               |                    |
| 0    | 1    | 1    | 0     | 1      | 接收线路状态     | OVERR、PARERR、FRAMEERR、BREAKINT           | 读 LSR             |
| 0    | 1    | 0    | 0     | 2      | 接收数据可用     | 接收到的字节数达到 FIFO 的触发点            | 读 RBR             |
| 1    | 1    | 0    | 0     | 2      | 接收数据超时     | 超过 4 个数据的时间未收到下一数据            | 读 RBR             |
| 0    | 0    | 1    | 0     | 3      | THR 寄存器空     | 发送保持寄存器空，IETHRE 从 0 变 1 可以重新使能中断 | 读 IIR 或写 THR    |
| 0    | 0    | 0    | 0     | 4      | MODEM 输入变化   | △CTS、△DSR、△RI、△DCD                      | 读 MSR             |

FCR：先进先出缓冲区 FIFO 控制寄存器，用于使能和复位 FIFO。
TRIG16：该位为 1 则接收 FIFO 的中断和硬件流控制的触发点等同于 16 字节 FIFO 时的触发点。
该位仅在 DLAB 为 1 时允许修改。
RECVTG1 和 RECVTG0：设置接收 FIFO 的中断和硬件流控制的触发点，00 对应 1 个字节，即接收
满 1 个字节产生接收数据可用的中断，并在使能硬件流控制时自动无效 RTS 引脚。

| TRIG16 | RECVTG1 | RECVTG0 | 触发点   |
|--------|---------|---------|----------|
| 0      | 0       | 0       | 1 字节   |
| 0      | 0       | 1       | 32 字节  |
| 0      | 1       | 0       | 128 字节 |
| 0      | 1       | 1       | 224 字节 |
| 1      | 0       | 0       | 1 字节   |
| 1      | 0       | 1       | 4 字节   |
| 1      | 1       | 0       | 8 字节   |
| 1      | 1       | 1       | 14 字节  |

TFIFORST：该位置 1 则清空发送 FIFO 中的数据（不含 TSR），该位能够自动清 0，无需软件清 0。
RFIFORST：该位置 1 则清空接收 FIFO 中的数据（不含 RSR），该位能够自动清 0，无需软件清 0。
FIFOEN：该位为 1 则启用 FIFO，该位清 0 则禁用 FIFO，禁用 FIFO 后为 16C450 兼容模式，相当
于 FIFO 只有一个字节（RECVTG1=0、RECVTG0=0、FIFOEN=1），建议启用 FIFO。

LCR：线路控制寄存器，用于控制串口通讯的格式。
DLAB：该位为除数锁存器存取使能，为 1 时才能存取 DLL 和 DLM，为 0 时才能存取 RBR/THR/IER。
BREAKEN：该位为 1 则强制产生 BREAK 线路间隔。
PARMODE1 和 PARMODE0：当 PAREN 为 1 时设置奇偶校验位的格式：00 则奇校验，01 则偶校验，10
则标志位（MARK，置 1），11 则空白位（SPACE，清 0）。
PAREN：该位为 1 则允许发送时产生和接收时校验奇偶校验位，为 0 则无奇偶校验位。
STOPBIT：该位为 1 则两个停止位，为 0 则一个停止位。
WORDSZ1 和 WORDSZ0：设置字长度，00 则 5 个数据位，01 则 6 个数据位，10 则 7 个数据位，11
则 8 个数据位。

MCR：调制解调器 MODEM 控制寄存器，用于控制 MODEM 输出。
HALF：该位为 1 则进入半双工收发模式，发送优先，不发送时为接收。半双工模式下 DTR 引脚总
是输出正在发送状态 TNOW，可以用于控制 RS485 收发切换。该位仅在 DLAB 为 1 时允许修改。
AFE：该位为 1 则允许 CTS 和 RTS 硬件自动流控制。如果 AFE 为 1，那么仅在检测到 CTS 引脚输
入有效（低电平有效）时串口才继续发送下一个数据，否则暂停串口发送，当 AFE 为 1 时的
CTS 输入状态变化不会产生 MODEM 状态中断。如果 AFE 为 1 并且 RTS 为 1，那么当接收 FIFO
空时，串口会自动有效 RTS 引脚（低电平有效），直到接收的字节数达到 FIFO 的触发点时，
串口才自动无效 RTS 引脚，并能够在接收 FIFO 空时再次有效 RTS 引脚。使用硬件自动带率控
制，可将己方的 CTS 引脚接到对方的 RTS 引脚，并将己方的 RTS 引脚送到对方的 CTS 引脚。
LOOP：该位为 1 则使能内部回路的测试模式。在内部回路的测试模式下，串口所有对外输出引脚
均为无效状态，TXD 内部返回到 RXD（即 TSR 的输出内部返回到 RSR 的输入），RTS 内部返回到
CTS，DTR 内部返回到 DSR，OUT1 内部返回到 RI，OUT2 内部返回到 DCD。
OUT2：该位为 1 则允许该串口的中断请求输出，否则该串口不产生实际中断请求。
OUT1：该位为用户可定义 MODEM 控制位，没有连接实际输出引脚。
RTS：该位为 1 则 RTS 引脚输出有效（低电平有效），否则 RTS 引脚输出无效。
DTR：该位为 1 则 DTR 引脚输出有效（低电平有效），否则 DTR 引脚输出无效。

LSR：线路状态寄存器，用于查询方式分析串口状态。
RFIFOERR：该位为 1 表示在接收 FIFO 中存在至少一个 PARERR、FRAMEERR 或 BREAKINT 错误。
TEMT：该位为 1 表示发送保持寄存器 THR 和发送移位寄存器 TSR 全空。
THRE：该位为 1 表示发送保持寄存器 THR 空。
BREAKINT：该位为 1 表示检测到 BREAK 线路间隔。
FRAMEERR：该位为 1 表示正在从接收 FIFO 中读取的数据的帧错误，缺少有效的停止位。
PARERR：该位为 1 表示正在从接收 FIFO 中读取的数据的奇偶校验错。
OVERR：该位为 1 表示接收 FIFO 缓冲区溢出。
DATARDY：该位为 1 表示接收 FIFO 中有接收到的数据，读取 FIFO 中所有数据后，该位自动清 0。
MSR：调制解调器 MODEM 状态寄存器，用于查询 MODEM 状态。
DCD：该位是 DCD 引脚的位反，为 1 表示 DCD 引脚有效（低电平有效）。
RI：该位是 RI 引脚的位反，为 1 表示 RI 引脚有效（低电平有效）。
DSR：该位是 DSR 引脚的位反，为 1 表示 DSR 引脚有效（低电平有效）。
CTS：该位是 CTS 引脚的位反，为 1 表示 CTS 引脚有效（低电平有效）。
△DCD：该位为 1 表示 DCD 引脚输入状态发生过变化。
△RI：该位为 1 表示 RI 引脚输入状态发生过变化。
△DSR：该位为 1 表示 DSR 引脚输入状态发生过变化。
△CTS：该位为 1 表示 CTS 引脚输入状态发生过变化。
SCR：用户可定义寄存器。
DLL 和 DLM：波特率除数锁存器，DLL 是低字节，DLM 是高字节，两者组成的 16 位除数用于由 16 位计
数器构成的串口波特率产生器。该除数 = 串口内部基准时钟 / 16 / 所需通讯波特率。如果串口
内部基准时钟为 1.8432MHz，所需波特率为 9600bps，则除数=1843200/16/9600=12。

## 7. 功能说明

### 7.1 查询与中断

CH382 芯片的两个串口以及并口合用一个 PCIE 中断请求引脚，所以在进入 PCIE 中断服务程序后，
首先应该分析出是否为 CH382 请求中断，以及是哪个串口或者并口的中断请求。当进入中断服务程序
后，有专用状态分析和依次查询两种方法：
专用状态分析是指首先读取 IINT 内部中断状态寄存器，IINT 位 0 标志有效说明是串口 0 中断，
IINT 位 1 标志有效说明是串口 1 中断，IINT 位 7 标志有效说明是并口中断，根据分析结果直接处理
并退出，无中断则直接退出。
依次查询是指首先读取并口的 PSR 或者 PXR 寄存器，如果是 ECP 方式则检查 PXR 寄存器的 ECPINTF
标志，否则检查 PSR 寄存器的!INTFLAG 标志，如果有效则说明有中断，处理后退出，无中断则读取
串口 0 的 IIR 寄存器，有中断则处理并退出，无中断则读取串口 1 的 IIR 寄存器，有中断则处理并退
出，无中断则直接退出。
当确认是某个串口的中断后，如果有必要还可以进一步分析 LSR 寄存器，分析中断原因并处理。
如果串口工作于中断方式，那么需要设置 IER 寄存器以允许相应的中断请求，并设置 MCR 寄存器
中的 OUT2 以允许中断输出。
如果并口工作于中断方式，那么需要设置 PCR 寄存器的 INTEN 以允许中断输出。其中，SPP 或 EPP
方式是以 ACK 引脚的上升沿启动中断请求，ECP 方式是以 ERR 引脚的下降沿启动中断请求。
如果串口工作于查询方式，那么无需设置 IER 和 MCR 的 OUT2，只需查询 LSR 寄存器并分析处理。
如果并口工作于查询方式，那么无需设置 PCR 的 INTEN，只需查询 PSR 和 PXR 寄存器并分析处理。

### 7.2 串口操作

具体操作可以参考单串口芯片 16C550 或者双串口芯片 CH432 或者八串口芯片 CH438 的说明。

### 7.3 并口操作

CH382 并口的 3 种工作方式之间互斥，默认为 SPP 方式。在 SPP 方式下可以实现 Nibble、Byte 和 PS/2 等附加方式，还可以通过设置 PXR 寄存器在 SPP、EPP 或 ECP 方式之间进行来回切换。下面是并口工作方式切换图。

![image](https://github.com/user-attachments/assets/4bd05d4a-a2bc-4c7c-b485-563ad9e77093)

在 SPP 方式下，可以用软件控制 PCR 和查询 PSR 实现 Nibble、Byte 和 PS/2 等传输，具体操作步
骤可以参考 IEEE1284 规范。
在 EPP 方式下，应该通过 PXR 的 EPPADDR 选择目标空间，通过 PCR 的 DIRIN 设置传输方向，然后
向 PDR 写入数据（对于反向传输则可以写入任意数据）启动 EPP 传输，并查询 PSR 直到!EPPREQ 为 1；
如果是反向传输则还需要从 PIR 读取数据（建议与 PSR 一起读取以提高效率）。
在 ECP 方式下，应该通过 PCR 的 DIRIN 和 PXR 的 ECPDIRIN 设置传输方向，对于正向传输，可以
向 PDR 写入数据启动 ECP 正向传输，并查询 PSR 直到!ECPOUT 为 1；对于反向传输，可以直接查询 PSR
直到!ECPIBF 为 0，再从 PIR 读取数据（建议与 PSR 一起读取以提高效率，并从 PSR 获取!ECPICMD）。


### 7.4 应用说明

CH382 芯片的串口输出引脚都是 3.3V LVCMOS 电平，兼容 5V TTL 电平，输入引脚能够承受 5V 耐
压，兼容 5V CMOS 电平、3.3V LVCMOS 和 5V TTL 及 LVTTL 电平，通过外加 RS232 电平转换器，可以
进一步转换为 RS232 串口。
异步串口方式下 CH382 芯片的引脚包括：数据传输引脚和 MODEM 联络信号引脚。数据传输引脚包
括：TXD 引脚和 RXD 引脚，默认都是高电平。MODEM 联络信号引脚包括：CTS 引脚、DSR 引脚、RI 引
脚、DCD 引脚、DTR 引脚、RTS 引脚，默认都是高电平。所有这些 MODEM 联络信号都可以作为通用 IO
引脚，由计算机应用程序控制并定义其用途。
CH382 内置了独立的收发缓冲区及 FIFO，支持单工、半双工或者全双工异步串行通讯。串行数据
包括 1 个低电平起始位、5、6、7 或 8 个数据位、0 个或者 1 个附加校验位或者标志位，1 个或者 2
个高电平停止位，支持奇校验/偶校验/标志校验/空白校验。CH382 支持常用通讯波特率：1200、2400、
4800、9600、19.2K、38.4K、57.6K、115.2K、230.4K、460.8K、921.6K、1.8432M、2.7648M、7.8125M
等。串口发送信号的波特率误差小于 0.2％，串口接收信号的允许波特率误差不小于 2％。
在计算机端的 Windows 和 Linux 操作系统下，CH382 的驱动程序能够兼容标准串口，所以绝大部
分原串口应用程序完全兼容，通常不需要作任何修改。
CH382 芯片的并口输出引脚都是 3.3V LVCMOS 电平，兼容 5V TTL 电平，输入引脚能够承受 5V 耐
压，兼容 5V CMOS 电平、3.3V LVCMOS 和 5V TTL 及 LVTTL 电平。
并口方式下 CH382 芯片的引脚包括：双向数据引脚、控制输出引脚和状态输入引脚。双向数据引
脚和控制输出引脚除 INIT 引脚之外，默认都是高电平。在 SPP 方式下，所有这些信号都可以作为通
用 IO 引脚，由计算机应用程序控制并定义其用途。
在计算机端的 Windows 和 Linux 操作系统下，CH382 的驱动程序能够兼容标准串口和标准打印口，
所以绝大部分原串口应用程序和并口应用程序完全兼容，通常不需要作任何修改。
CH382 可以用于通过 PCIE 总线为计算机扩展额外的高速 RS232 串口和并口/打印口、支持自动硬
件速率控制的高波特率串口、RS422 或者 RS485 通讯接口等。

## 8. 参数

### 8.1 绝对最大值（临界或者超过绝对最大值将可能导致芯片工作不正常甚至损坏）

| 名称   | 参数说明                                                  | 最小值 | 最大值 | 单位 |
|--------|----------------------------------------------------------|--------|--------|------|
| TA     | 工作时的环境温度                                          | -40    | 85     | ℃    |
| TS     | 储存时的环境温度                                          | -55    | 125    | ℃    |
| VCC33  | I/O 电源电压（VCC33 接电源，GND 接地）                    | -0.4   | 4.2    | V    |
| VCC18  | 内核电源电压（VCC18 接电源，GND 接地）                    | -0.4   | 2.3    | V    |
| VCC18A | 传输电源电压（VCC18A 接电源，GND 接地）                   | -0.4   | 2.3    | V    |
| VIO    | PCIE信号和各辅助信号输入或者输出引脚上的电压              | -0.4   | VCC33+0.4 | V    |
| VIO5   | 串口和并口及扩展输入或者输出引脚上的电压                  | -0.4   | 5.3    | V    |

### 8.2  电气参数（测试条件：TA=25℃，VCC33=3.3V，不包括连接 PCIE 总线的引脚）

| 名称   | 参数说明                                           | 最小值 | 典型值 | 最大值 | 单位 |
|--------|---------------------------------------------------|--------|--------|--------|------|
| VCC33  | I/O 电源电压                                      | 3.0    | 3.3    | 3.6    | V    |
| VCC18  | 内核电源电压                                      | 1.65   | 1.8    | 1.95   | V    |
| VCC18A | 传输电源电压                                      | 1.65   | 1.8    | 1.95   | V    |
| ICC    | 工作时的总电源电流                                | 70     | 170    | -      | mA   |
| VIL    | 低电平输入电压                                    | -0.4   | -      | 0.7    | V    |
| VIH    | 高电平输入电压                                    | 2.0    | -      | VCC33+0.4 | V  |
| VOL    | 低电平输出电压（4mA 吸入电流）                    | -      | -      | 0.4    | V    |
| VOH    | 高电平输出电压（4mA 输出电流）                    | VCC33-0.4 | -    | -      | V    |
| IIN    | 无上拉的输入端的输入电流                          | -      | 10     | -      | µA   |
| IUP    | 带上拉的输入端的输入电流                          | 20     | 40     | 100    | µA   |

### 8.3 时序参数（测试条件：TA=25℃，VCC33=3.3V，参考附图）

| 名称  | 参数说明                         | 最小值 | 典型值 | 最大值 | 单位 |
|-------|---------------------------------|--------|--------|--------|------|
| FCLK  | CLK 输入频率（PCIE 总线的主频） | 0      | 100    | 105    | MHz  |
| FSCL  | 两线接口SCL输出频率（自动加载时）|     | 244    | 260      | KHz  |
| FXI   | XI 输入频率、晶体频率           | 0.9216 | 22.1184| 64     | MHz  |

## 9. 应用

### 9.1 双串口+并口

这是基于 CH382 芯片的 PCIE 双串口+并口/打印口的基本电路，图中未包含 RS232 电平转换芯片。
U3 是可选的外部配置芯片，网站上提供了 Windows 系统下的在线配置工具软件。
IEEE1284 要求打印口信号保持阻抗匹配，所以，打印口并行数据线可能需要串联电阻和并联电
容，在要求不高时也可以省掉。
晶体 X1 和电容 C15、C16 用于时钟振荡电路，如果 CKSEL 引脚连接到 PERST#引脚，那么 X1 和 C15
及 C16 都可以省掉。其它电容用于电源退耦，容量为 10uF 的电容是钽电容，容量为 0.1uF 的电容是
独石或者高频瓷片电容，分别就近并联在 CH382 的电源引脚上。
![image](https://github.com/user-attachments/assets/535c203c-213c-4d3d-a88a-9d81744fa076)
